<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoraBooks - Bien Sousou</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="logo">
                    <h1>CoraBooks</h1>
                    <span class="tagline">Una Libreria Bien Sousou</span>
                </div>
                <nav class="nav">
                    <button class="nav-btn active" onclick="showSection('browse')">
                        Browse Books
                    </button>
                    <button class="nav-btn" onclick="showSection('upload')">
                        Upload Book
                    </button>
                    <button class="nav-btn" onclick="showSection('admin')">
                        Admin
                    </button>
                    <button class="nav-btn" onclick="showSection('about')">
                        About
                    </button>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <div class="container">

                <!-- Browse Books Section -->
                <section id="browse-section" class="section active">
                    <div class="section-header">
                        <h2>Browse Books</h2>
                        <p>Pa los que se niegan a pagar</p>
                    </div>
                    <div id="files-list" class="books-grid">
                        <!-- Books will be loaded here dynamically -->
                    </div>
                    <div class="loading" id="loading">
                        <div class="loading-spinner"></div>
                        <span>Loading books...</span>
                    </div>
                </section>

                <!-- Upload Section -->
                <section id="upload-section" class="section">
                    <div class="section-header">
                        <h2>Upload New Book</h2>
                        <p>Comparte pana no seas maceta :) <br> Solo se permiten libros en PDF, EPUB o MOBI.</p>
                    </div>
                    
                    <!-- File Upload Info -->
                    <div class="info-banner">
                        <div class="info-content">
                            <h4>ÔøΩ Upload Information</h4>
                            <div class="upload-info">
                                <div class="info-item">
                                    <strong>üìÅ Supported Formats:</strong> PDF, EPUB, MOBI
                                </div>
                                <div class="info-item">
                                    <strong>üìè Maximum File Size:</strong> 2 GB is the maximum allowed file size.
                                </div>
                                <div class="info-item">
                                    <strong>üìñ eBook Formats:</strong> EPUB and MOBI files need special reader apps:
                                    <div class="reader-links">
                                        <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.books&hl=en_US" target="_blank" class="reader-link">
                                            üì± Google Play Books
                                        </a>
                                        <a href="https://apps.apple.com/us/app/apple-books/id364709193" target="_blank" class="reader-link">
                                            üçé Apple Books
                                        </a>
                                        <a href="https://epub-reader.online/" target="_blank" class="reader-link">
                                            üíª Online Reader
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="upload-card">
                        <form id="uploadForm" enctype="multipart/form-data" class="upload-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fileName">Book Title</label>
                                    <input type="text" id="fileName" name="fileName" required placeholder="Enter the book title">
                                </div>
                                <div class="form-group">
                                    <label for="file">Select File</label>
                                    <input type="file" id="file" name="file" required accept=".pdf,.epub,.mobi">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="description">Description</label>
                                <textarea id="description" name="description" required placeholder="Describe the book content..."></textarea>
                            </div>
                            
                            <!-- Cover input removed: covers are auto-generated from the first page of PDFs -->
                            
                            <!-- Progress Bar -->
                            <div id="uploadProgress" class="upload-progress hidden">
                                <div class="progress-info">
                                    <span class="progress-label">Uploading...</span>
                                    <span class="progress-percentage">0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill"></div>
                                </div>
                                <div class="progress-details">
                                    <span class="file-name"></span>
                                    <span class="file-size"></span>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn-primary" id="uploadBtn">
                                    Upload Book
                                </button>
                                <button type="reset" class="btn-secondary">
                                    Clear Form
                                </button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- About Section -->
                <section id="about-section" class="section">
                    <div class="section-header">
                        <h2>About CoraBooks</h2>
                        <p>La necesidad es la madre de la inovacion...y aqui se necesita muchoüíÄ</p>
                    </div>
                    <div class="about-content">
                        <div class="about-main-card">
                            <div class="about-icon">üìö</div>
                            <div class="about-text">
                                <p>üö® Para la mejor experiencia, abra la pagina en computadoa üö® </p>

                                <p>Esta pagina esta hecha con el propsito de que estudiantes puedan compartir y acceder a libros de manera gratuita. A ver si la beca sobra pa algo üôÉ</p>
                                
                                <p>La pagina todavia esta en desarollo, so la colecion de libros quizas no es muy grande, pero con el tiempo espero poder seguir a√±adiendole mas. El app es bastante nuevo y para que el servicio se mantenga gratis estoy usando un servidor que no es el mejor, por eso tambien aveces los downloads se ponen lentos. El app no es perfecto y espero poder seguir mejorandolo para que sea mas facil de usar y en el futuro usar un mejor servidor. Mientras tanto espero que esto pueda resolver.  </p>

                                <p> Se que subir libros puede tomar mucho tiempo y eso puede causar errores, si deseas subir un libro y sigue dando problemas o no quieres pasar el mal rato lo puedes enviar aqui por whatsapp y yo lo subo: corabooks67@gmail.com</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Admin Section -->
                <section id="admin-section" class="section">
                    <div class="section-header">
                        <h2>Admin Dashboard</h2>
                        <p>Aqui no bro</p>
                    </div>
                    <div class="upload-card">
                        <div class="form-row">
                            <div class="form-group" style="flex:2;">
                                <label for="adminKeyInput">Admin Key</label>
                                <input type="password" id="adminKeyInput" placeholder="Enter admin key" />
                            </div>
                            <div class="form-group" style="align-self:flex-end;">
                                <button id="adminLoginBtn" class="btn-primary" type="button">Unlock</button>
                                <button id="adminLogoutBtn" class="btn-secondary" type="button">Lock</button>
                            </div>
                        </div>
                        <div id="adminStatus" class="muted" style="margin-top:.25rem"></div>
                        <div id="adminCleanupControls" class="hidden">
                            <hr style="border-color: var(--border-color); margin: 1rem 0; opacity:.4;" />
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cleanupThreshold">Cleanup threshold (hours)</label>
                                    <input type="number" id="cleanupThreshold" min="1" step="1" value="6" />
                                </div>
                                <div class="form-group" style="align-self:flex-end;">
                                    <button id="adminCleanupBtn" class="btn-outline" type="button">Cleanup Pending</button>
                                </div>
                            </div>
                            <div id="adminCleanupResult" class="muted" style="margin-top:.25rem"></div>
                        </div>
                    </div>

                    <div class="books-grid" id="adminFilesGrid" style="margin-top:1rem">
                        <!-- Admin file cards -->
                    </div>
                </section>
            </div>
        </main>

        <!-- Notification Container -->
        <div id="notificationContainer" class="notification-container"></div>

        <!-- File Preview Modal -->
        <div id="previewModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="previewFileName">Book Preview</h3>
                    <button class="close-btn" onclick="closePreview()">&times;</button>
                </div>
                <div class="modal-body">
                    <embed id="pdfViewer" type="application/pdf" width="100%" height="500px">
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" onclick="downloadFile()">
                        Download Book
                    </button>
                    <button class="btn-secondary" onclick="closePreview()">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

        <!-- PDF.js for client-side first-page thumbnail generation -->
        <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
        <script>
            if (window.pdfjsLib) {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
            }
        </script>
        <script src="script.js"></script>
</body>
</html>